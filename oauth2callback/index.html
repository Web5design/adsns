<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #msg {
        position: absolute;
        top: 50%;
        left: 0;
        z-index: 1;
        font: 200px/1 sans-serif;
        opacity: .45;
        width: 100%;
        height: 200px;
        text-align: center;
        margin-top: -100px;
      }
      @media only screen 
      and (min-device-width : 320px) 
      and (max-device-width : 480px) {
        #msg {
          font-size: 100px;
          height: 100px;
          margin-top: -50px;
        }
      }
    </style>
  </head>
  <body>
    <div id="msg"></div>
    <div id="chart_div"></div>
    <script src="//www.google.com/jsapi"></script>
<script>
  google.load('visualization', '1', {packages:['corechart']});
  google.setOnLoadCallback(drawChart);

  function drawChart() {
    var token, script, where, now, startDate, endDate;

    location.hash.slice(1).split('&').some(function(a) {
      var b = a.split('=');
      if (b[0] === 'access_token') {
        return (token = b[1]);
      }
    });

    function formatDate(d) {
      function pad(s) {
        s = s.toString();
        return ('0' + s).slice(s.length - 1);
      }
      return d.getFullYear() + '-' + pad(d.getMonth() + 1) + '-' +
        pad(d.getDate());
    }

    now = new Date();
    startDate = formatDate(new Date(now.getFullYear(), now.getMonth(), 1));
    endDate = new Date(new Date(now.getFullYear(), now.getMonth() + 1, 1) - 1);
    days = endDate.getDate();
    endDate = formatDate(endDate);

    return earns({
 "kind": "adsense#report",
 "totalMatchedRows": "24",
 "headers": [
  {
   "name": "DATE",
   "type": "DIMENSION"
  },
  {
   "name": "EARNINGS",
   "type": "METRIC_CURRENCY",
   "currency": "USD"
  }
 ],
 "rows": [
  [
   "2013-05-01",
   "20.50"
  ],
  [
   "2013-05-02",
   "28.45"
  ],
  [
   "2013-05-03",
   "13.29"
  ],
  [
   "2013-05-04",
   "7.98"
  ],
  [
   "2013-05-05",
   "6.98"
  ],
  [
   "2013-05-06",
   "24.39"
  ],
  [
   "2013-05-07",
   "20.93"
  ],
  [
   "2013-05-08",
   "19.79"
  ],
  [
   "2013-05-09",
   "19.96"
  ],
  [
   "2013-05-10",
   "2.50"
  ],
  [
   "2013-05-11",
   "8.68"
  ],
  [
   "2013-05-12",
   "12.09"
  ],
  [
   "2013-05-13",
   "25.57"
  ],
  [
   "2013-05-14",
   "15.74"
  ],
  [
   "2013-05-15",
   "11.51"
  ],
  [
   "2013-05-16",
   "17.27"
  ],
  [
   "2013-05-17",
   "6.21"
  ],
  [
   "2013-05-18",
   "9.51"
  ],
  [
   "2013-05-19",
   "8.27"
  ],
  [
   "2013-05-20",
   "16.34"
  ],
  [
   "2013-05-21",
   "23.43"
  ],
  [
   "2013-05-22",
   "24.47"
  ],
  [
   "2013-05-23",
   "10.13"
  ],
  [
   "2013-05-24",
   "3.06"
  ]
 ],
 "totals": [
  "",
  "357.06"
 ],
 "averages": [
  "",
  "14.88"
 ]
}
);
    if (token) {
      script = document.createElement('script');
      script.src = [
        'https://www.googleapis.com/adsense/v1.2/reports?access_token=',
        token,
        '&startDate=',
        startDate,
        '&endDate=',
        endDate,
        '&dimension=DATE&metric=EARNINGS&callback=earns'
      ].join('');

      where = document.getElementsByTagName('script');
      where = where[where.length - 1];
      where.parentNode.insertBefore(script, where);
    }

  }

  function plot(data) {
    var div = document.getElementById('chart_div'),
        options = {
          legend: {position: 'none'},
          hAxis: {gridlines: {count: data.length - 1}},
          vAxis: {gridlines: {count: -1}},
          chartArea: {left: '10%', top: 0, width: '100%', height: '90%'}
        };

    div.style.width = window.innerWidth + 'px';
    div.style.height = window.innerHeight + 'px';
    data = google.visualization.arrayToDataTable(data);
    chart = new google.visualization.LineChart(div);
    chart.draw(data, options);
  }

  function earns(results) {
    var estimate, data, chart,
        total = 0;

    console.log(results);
    if (results.error) {
      document.getElementById('msg').innerHTML = results.error.message;
    }

    if (!results.rows) {
      return;
    }

    data = [['day', 'avg']];
    results.rows.forEach(function(item, index) {
      total += parseFloat(item[1], 10);
      estimate = (total / (index + 1)) * days;
      estimate = parseFloat((estimate).toFixed(2), 10);
      console.log(estimate);
      data.push([index + 1, estimate]);
    });
    document.getElementById('msg').innerHTML = estimate.toLocaleString();

    plot(data);
  }
</script>
</body>
</html>
